<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Emotions.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">OpenNARS</a> &gt; <a href="index.source.html" class="el_package">org.opennars.plugin.mental</a> &gt; <span class="el_source">Emotions.java</span></div><h1>Emotions.java</h1><pre class="source lang-java linenums">/* 
 * The MIT License
 *
 * Copyright 2018 The OpenNARS authors.
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the &quot;Software&quot;), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */
package org.opennars.plugin.mental;

import java.io.Serializable;
import org.opennars.control.DerivationContext;
import org.opennars.entity.*;
import org.opennars.inference.BudgetFunctions;
import org.opennars.io.Symbols;
import org.opennars.language.Inheritance;
import org.opennars.language.SetInt;
import org.opennars.language.Term;
import org.opennars.main.Nar;
import org.opennars.plugin.Plugin;

/** emotional value; self-felt internal mental states; variables used to record emotional values */
public class Emotions implements Plugin, Serializable {

<span class="pc" id="L40">    public volatile float HAPPY_EVENT_HIGHER_THRESHOLD=0.75f;</span>
<span class="pc" id="L41">    public volatile float HAPPY_EVENT_LOWER_THRESHOLD=0.25f;</span>
<span class="pc" id="L42">    public volatile float BUSY_EVENT_HIGHER_THRESHOLD=0.9f; //1.6.4, step by step^, there is already enough new things ^^</span>
<span class="pc" id="L43">    public volatile float BUSY_EVENT_LOWER_THRESHOLD=0.1f;</span>
<span class="pc" id="L44">    public volatile int CHANGE_STEPS_DEMANDED = 1000;</span>

<span class="pc" id="L46">    public double lasthappy=0.5;</span>
<span class="pc" id="L47">    public long last_happy_time = 0;</span>
<span class="pc" id="L48">    public long last_busy_time = 0;</span>


    /** average desire-value */
    private float happy;
    /** average priority */
    private float busy;



    public void setHAPPY_EVENT_HIGHER_THRESHOLD(double val) {
<span class="nc" id="L59">        this.HAPPY_EVENT_HIGHER_THRESHOLD = (float) val;</span>
<span class="nc" id="L60">    }</span>
    public double getHAPPY_EVENT_HIGHER_THRESHOLD() {
<span class="nc" id="L62">        return HAPPY_EVENT_HIGHER_THRESHOLD;</span>
    }

    public void setHAPPY_EVENT_LOWER_THRESHOLD(double val) {
<span class="nc" id="L66">        this.HAPPY_EVENT_LOWER_THRESHOLD = (float) val;</span>
<span class="nc" id="L67">    }</span>
    public double getHAPPY_EVENT_LOWER_THRESHOLD() {
<span class="nc" id="L69">        return HAPPY_EVENT_LOWER_THRESHOLD;</span>
    }

    public void setBUSY_EVENT_HIGHER_THRESHOLD(double val) {
<span class="nc" id="L73">        this.BUSY_EVENT_HIGHER_THRESHOLD = (float) val;</span>
<span class="nc" id="L74">    }</span>
    public double getBUSY_EVENT_HIGHER_THRESHOLD() {
<span class="nc" id="L76">        return BUSY_EVENT_HIGHER_THRESHOLD;</span>
    }

    public void setBUSY_EVENT_LOWER_THRESHOLD(double val) {
<span class="nc" id="L80">        this.BUSY_EVENT_LOWER_THRESHOLD = (float) val;</span>
<span class="nc" id="L81">    }</span>
    public double getBUSY_EVENT_LOWER_THRESHOLD() {
<span class="nc" id="L83">        return BUSY_EVENT_LOWER_THRESHOLD;</span>
    }

    public void setCHANGE_STEPS_DEMANDED(double val) {
<span class="nc" id="L87">        this.CHANGE_STEPS_DEMANDED = (int) val;</span>
<span class="nc" id="L88">    }</span>
    public double getCHANGE_STEPS_DEMANDED() {
<span class="nc" id="L90">        return CHANGE_STEPS_DEMANDED;</span>
    }


    public void resetEmotions() {
<span class="fc" id="L95">        this.happy = 0.5f;</span>
<span class="fc" id="L96">        this.busy = 0.5f;</span>
<span class="fc" id="L97">        this.lastbusy = 0.5f;</span>
<span class="fc" id="L98">        this.lasthappy = 0.5f;</span>
<span class="fc" id="L99">    }</span>
    
<span class="nc" id="L101">    public Emotions(){}</span>
    public Emotions(float HAPPY_EVENT_LOWER_THRESHOLD, float HAPPY_EVENT_HIGHER_THRESHOLD,
<span class="fc" id="L103">                    float BUSY_EVENT_LOWER_THRESHOLD, float BUSY_EVENT_HIGHER_THRESHOLD, int CHANGE_STEPS_DEMANDED) {</span>
<span class="fc" id="L104">        this.BUSY_EVENT_LOWER_THRESHOLD = BUSY_EVENT_LOWER_THRESHOLD;</span>
<span class="fc" id="L105">        this.BUSY_EVENT_HIGHER_THRESHOLD = BUSY_EVENT_HIGHER_THRESHOLD;</span>
<span class="fc" id="L106">        this.HAPPY_EVENT_LOWER_THRESHOLD = HAPPY_EVENT_LOWER_THRESHOLD;</span>
<span class="fc" id="L107">        this.HAPPY_EVENT_HIGHER_THRESHOLD = HAPPY_EVENT_HIGHER_THRESHOLD;</span>
<span class="fc" id="L108">        this.CHANGE_STEPS_DEMANDED = CHANGE_STEPS_DEMANDED;</span>
<span class="fc" id="L109">    }</span>

    public void set(final float happy, final float busy) {
<span class="nc" id="L112">        this.happy = happy;</span>
<span class="nc" id="L113">        this.busy = busy;</span>
<span class="nc" id="L114">    }</span>

    public float happy() {
<span class="fc" id="L117">        return happy;</span>
    }

    public float busy() {
<span class="nc" id="L121">        return busy;</span>
    }


    public void adjustSatisfaction(final float newValue, final float weight, final DerivationContext nal) {
        
        //        float oldV = happyValue;
<span class="fc" id="L128">        happy += newValue * weight;</span>
<span class="fc" id="L129">        happy /= 1.0f + weight;</span>
        
<span class="pc bpc" id="L131" title="1 of 2 branches missed.">        if(!enabled) {</span>
<span class="nc" id="L132">            return;</span>
        }
        
<span class="fc" id="L135">        float frequency=-1;</span>
<span class="fc bfc" id="L136" title="All 4 branches covered.">        if(Math.abs(happy-lasthappy) &gt; CHANGE_THRESHOLD &amp;&amp; nal.time.time()-last_happy_time &gt; CHANGE_STEPS_DEMANDED) {</span>
<span class="pc bpc" id="L137" title="1 of 4 branches missed.">            if(happy &gt; HAPPY_EVENT_HIGHER_THRESHOLD &amp;&amp; lasthappy &lt;= HAPPY_EVENT_HIGHER_THRESHOLD) {</span>
<span class="fc" id="L138">                frequency=1.0f;</span>
            }
<span class="pc bpc" id="L140" title="1 of 4 branches missed.">            if(happy &lt; HAPPY_EVENT_LOWER_THRESHOLD &amp;&amp; lasthappy &gt;= HAPPY_EVENT_LOWER_THRESHOLD) {</span>
<span class="fc" id="L141">                frequency=0.0f;</span>
            }
<span class="fc" id="L143">            lasthappy=happy;</span>
<span class="fc" id="L144">            last_happy_time = nal.time.time();</span>
        }
        
<span class="fc bfc" id="L147" title="All 2 branches covered.">        if(frequency!=-1) { //ok lets add an event now</span>
<span class="fc" id="L148">            final Term predicate=SetInt.make(new Term(&quot;satisfied&quot;));</span>
<span class="fc" id="L149">            final Term subject=Term.SELF;</span>
<span class="fc" id="L150">            final Inheritance inh=Inheritance.make(subject, predicate);</span>
<span class="fc" id="L151">            final TruthValue truth=new TruthValue(happy,nal.narParameters.DEFAULT_JUDGMENT_CONFIDENCE, nal.narParameters);</span>
<span class="fc" id="L152">            final Sentence s=new Sentence(inh,Symbols.JUDGMENT_MARK,truth,new Stamp(nal.time, nal.memory));</span>
<span class="fc" id="L153">            s.stamp.setOccurrenceTime(nal.time.time());</span>

<span class="fc" id="L155">            final BudgetValue budgetOfNewTask = new BudgetValue(nal.narParameters.DEFAULT_JUDGMENT_PRIORITY,</span>
                                                                nal.narParameters.DEFAULT_JUDGMENT_DURABILITY,
<span class="fc" id="L157">                                                                BudgetFunctions.truthToQuality(truth),</span>
                                                                nal.narParameters);
<span class="fc" id="L159">            final Task t = new Task(s, budgetOfNewTask, Task.EnumType.INPUT);</span>

<span class="fc" id="L161">            nal.addTask(t, &quot;emotion&quot;);</span>
            /*if(Parameters.REFLECT_META_HAPPY_GOAL) { //remind on the goal whenever happyness changes, should suffice for now
                TruthValue truth2=new TruthValue(1.0f,Parameters.DEFAULT_GOAL_CONFIDENCE);
                Sentence s2=new Sentence(inh,Symbols.GOAL_MARK,truth2,new Stamp(nal.memory));
                s2.stamp.setOccurrenceTime(nal.memory.time());
                Task t2=new Task(s2,new BudgetValue(Parameters.DEFAULT_GOAL_PRIORITY,Parameters.DEFAULT_GOAL_DURABILITY,BudgetFunctions.truthToQuality(truth2)));
                nal.addTask(t2, &quot;metagoal&quot;);
                //this is a good candidate for innate belief for consider and remind:
                Operator consider=nal.memory.getOperator(&quot;^consider&quot;);
                Operator remind=nal.memory.getOperator(&quot;^remind&quot;);
                Term[] arg=new Term[1];
                arg[0]=inh;
                if(InternalExperience.enabled &amp;&amp; Parameters.CONSIDER_REMIND) {
                    Operation op_consider=Operation.make(consider, arg, true);
                    Operation op_remind=Operation.make(remind, arg, true);
                    Operation[] op=new Operation[2];
                    op[0]=op_remind; //order important because usually reminding something
                    op[1]=op_consider; //means it has good chance to be considered after
                    for(Operation o : op) {
                        TruthValue truth3=new TruthValue(1.0f,Parameters.DEFAULT_JUDGMENT_CONFIDENCE);
                        Sentence s3=new Sentence(o,Symbols.JUDGMENT_MARK,truth3,new Stamp(nal.memory));
                        s3.stamp.setOccurrenceTime(nal.memory.time());

                        //INTERNAL_EXPERIENCE_DURABILITY_MUL
                        BudgetValue budget=new BudgetValue(Parameters.DEFAULT_JUDGMENT_PRIORITY,Parameters.DEFAULT_JUDGMENT_DURABILITY,BudgetFunctions.truthToQuality(truth3));
                        budget.setPriority(budget.getPriority()*InternalExperience.INTERNAL_EXPERIENCE_PRIORITY_MUL);
                        budget.setDurability(budget.getPriority()*InternalExperience.INTERNAL_EXPERIENCE_DURABILITY_MUL);
                        Task t3=new Task(s3,budget);
                        nal.addTask(t3, &quot;internal experience for consider and remind&quot;);
                    }
                }
            }*/
        }
        //        if (Math.abs(oldV - happyValue) &gt; 0.1) {
        //            Record.append(&quot;HAPPY: &quot; + (int) (oldV*10.0) + &quot; to &quot; + (int) (happyValue*10.0) + &quot;\n&quot;);
<span class="fc" id="L196">    }</span>
    
<span class="pc" id="L198">    public double lastbusy=0.5;</span>
<span class="pc" id="L199">    public final double CHANGE_THRESHOLD = 0.25f;</span>
    public void adjustBusy(final float newValue, final float weight, final DerivationContext nal) {

<span class="fc" id="L202">        busy += newValue * weight;</span>
<span class="fc" id="L203">        busy /= (1.0f + weight);</span>
        
<span class="pc bpc" id="L205" title="1 of 2 branches missed.">        if(!enabled) {</span>
<span class="nc" id="L206">            return;</span>
        }
        
<span class="fc" id="L209">        float frequency=-1;</span>
<span class="fc bfc" id="L210" title="All 4 branches covered.">        if(Math.abs(busy-lastbusy) &gt; CHANGE_THRESHOLD &amp;&amp; nal.time.time()-last_busy_time &gt; CHANGE_STEPS_DEMANDED) {</span>
<span class="pc bpc" id="L211" title="3 of 4 branches missed.">            if(busy &gt; BUSY_EVENT_HIGHER_THRESHOLD &amp;&amp; lastbusy &lt;= BUSY_EVENT_HIGHER_THRESHOLD) {</span>
<span class="nc" id="L212">                frequency=1.0f;</span>
            }
<span class="pc bpc" id="L214" title="3 of 4 branches missed.">            if(busy &lt; BUSY_EVENT_LOWER_THRESHOLD &amp;&amp; lastbusy &gt;= BUSY_EVENT_LOWER_THRESHOLD) {</span>
<span class="nc" id="L215">                frequency=0.0f;</span>
            }
<span class="fc" id="L217">            lastbusy=busy;</span>
<span class="fc" id="L218">            last_busy_time = nal.time.time();</span>
        }
        
<span class="pc bpc" id="L221" title="1 of 2 branches missed.">        if(frequency!=-1) { //ok lets add an event now</span>
<span class="nc" id="L222">            final Term predicate=SetInt.make(new Term(&quot;busy&quot;));</span>
<span class="nc" id="L223">            final Term subject=new Term(&quot;SELF&quot;);</span>
<span class="nc" id="L224">            final Inheritance inh=Inheritance.make(subject, predicate);</span>
<span class="nc" id="L225">            final TruthValue truth=new TruthValue(busy,nal.narParameters.DEFAULT_JUDGMENT_CONFIDENCE, nal.narParameters);</span>
<span class="nc" id="L226">            final Sentence s = new Sentence(</span>
                inh,
                Symbols.JUDGMENT_MARK,
                truth,
                new Stamp(nal.time, nal.memory));
<span class="nc" id="L231">            s.stamp.setOccurrenceTime(nal.time.time());</span>

<span class="nc" id="L233">            final BudgetValue budgetForNewTask = new BudgetValue(nal.narParameters.DEFAULT_JUDGMENT_PRIORITY,</span>
                nal.narParameters.DEFAULT_JUDGMENT_DURABILITY,
<span class="nc" id="L235">                BudgetFunctions.truthToQuality(truth), nal.narParameters);</span>
<span class="nc" id="L236">            final Task t = new Task(s, budgetForNewTask, Task.EnumType.INPUT);</span>
<span class="nc" id="L237">            nal.addTask(t, &quot;emotion&quot;);</span>
        }
<span class="fc" id="L239">    }</span>

<span class="pc" id="L241">    boolean enabled = false; //false means it needs to be retrieved using feelSatisfied / feelBusy instead</span>
    @Override
    public boolean setEnabled(final Nar n, final boolean enabled) {
<span class="fc" id="L244">        this.enabled = enabled;</span>
<span class="pc bpc" id="L245" title="1 of 2 branches missed.">        if(this.enabled) {</span>
<span class="fc" id="L246">            resetEmotions();</span>
        }
<span class="fc" id="L248">        return enabled;</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.2.201808211720</span></div></body></html>